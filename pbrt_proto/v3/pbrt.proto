edition = "2023";

package pbrt_proto.v3;

message Accelerator {
  message Bvh {
    enum SplitMethod {
      option features.enum_type = CLOSED;
      SAH = 0;
      MIDDLE = 1;
      EQUAL = 2;
      HLBVH = 3;
    }

    int32 maxnodeprims = 1 [default = 4];
    SplitMethod splitmethod = 2;
  }

  message KdTree {
    int32 intersectcost = 1 [default = 80];
    int32 traversalcost = 2 [default = 1];
    double emptybonus = 3 [default = 0.5];
    int32 maxprims = 4 [default = 1];
    int32 maxdepth = 5 [default = -1];
  }

  oneof accelerator_type {
    Bvh bvh = 1;
    KdTree kdtree = 2;
  }
}

message ActiveTransform {
  enum ActiveTransformation {
    option features.enum_type = CLOSED;
    ALL = 1;
    START_TIME = 2;
    END_TIME = 3;
  };

  ActiveTransformation active = 1 [features.field_presence = LEGACY_REQUIRED];
}

message AttributeBegin {
  // Empty Message
}

message AttributeEnd {
  // Empty Message
}

message ConcatTransform {
  double m00 = 1 [features.field_presence = LEGACY_REQUIRED];
  double m01 = 2 [features.field_presence = LEGACY_REQUIRED];
  double m02 = 3 [features.field_presence = LEGACY_REQUIRED];
  double m03 = 4 [features.field_presence = LEGACY_REQUIRED];
  double m10 = 5 [features.field_presence = LEGACY_REQUIRED];
  double m11 = 6 [features.field_presence = LEGACY_REQUIRED];
  double m12 = 7 [features.field_presence = LEGACY_REQUIRED];
  double m13 = 8 [features.field_presence = LEGACY_REQUIRED];
  double m20 = 9 [features.field_presence = LEGACY_REQUIRED];
  double m21 = 10 [features.field_presence = LEGACY_REQUIRED];
  double m22 = 11 [features.field_presence = LEGACY_REQUIRED];
  double m23 = 12 [features.field_presence = LEGACY_REQUIRED];
  double m30 = 13 [features.field_presence = LEGACY_REQUIRED];
  double m31 = 14 [features.field_presence = LEGACY_REQUIRED];
  double m32 = 15 [features.field_presence = LEGACY_REQUIRED];
  double m33 = 16 [features.field_presence = LEGACY_REQUIRED];
}

message CoordinateSystem {
  string name = 1 [features.field_presence = LEGACY_REQUIRED];
}

message CoordSysTransform {
  string name = 1 [features.field_presence = LEGACY_REQUIRED];
}

message Film {
  message Image {
    message CropWindow {
      double x_min = 1 [default = 0.0];
      double x_max = 2 [default = 1.0];
      double y_min = 3 [default = 0.0];
      double y_max = 4 [default = 1.0];
    };

    int32 xresolution = 1 [default = 1280];
    int32 yresolution = 2  [default = 720];
    CropWindow cropwindow = 3;
    double scale = 4  [default = 1.0];
    double maxsampleluminance = 5 [default = inf];
    double diagonal = 6 [default = 35.0];
    string filename = 7 [default = "pbrt.exr"];
  }

  oneof film_type {
    Image image = 1;
  }
}

message Identity {
  // Empty Message
}

message Include {
  string path = 1 [features.field_presence = LEGACY_REQUIRED];
}

message LookAt {
  double eye_x = 1 [features.field_presence = LEGACY_REQUIRED];
  double eye_y = 2 [features.field_presence = LEGACY_REQUIRED];
  double eye_z = 3 [features.field_presence = LEGACY_REQUIRED];
  double look_x = 4 [features.field_presence = LEGACY_REQUIRED];
  double look_y = 5 [features.field_presence = LEGACY_REQUIRED];
  double look_z = 6 [features.field_presence = LEGACY_REQUIRED];
  double up_x = 7 [features.field_presence = LEGACY_REQUIRED];
  double up_y = 8 [features.field_presence = LEGACY_REQUIRED];
  double up_z = 9 [features.field_presence = LEGACY_REQUIRED];
}

message ReverseOrientation {
  // Empty Message
}

message Rotate {
  double angle = 1 [features.field_presence = LEGACY_REQUIRED];
  double x = 2 [features.field_presence = LEGACY_REQUIRED];
  double y = 3 [features.field_presence = LEGACY_REQUIRED];
  double z = 4 [features.field_presence = LEGACY_REQUIRED];
}

message Sampler {
  message Halton {
    int32 pixelsamples = 1 [default = 16];
    bool samplepixelcenter = 2 [default = false];
  }

  message MaxMinDist {
    int32 pixelsamples = 1 [default = 16];
    int32 dimensions = 2 [default = 4];
  }

  message Random {
    int32 pixelsamples = 1 [default = 4];
  }

  message Sobol {
    int32 pixelsamples = 1 [default = 16];
  }

  message Stratified {
    bool jitter = 1 [default = true];
    int32 xsamples = 2 [default = 4];
    int32 ysamples = 3 [default = 4];
    int32 dimensions = 4 [default = 4];
  }

  message ZeroTwoSequence {
    int32 pixelsamples = 1 [default = 16];
    int32 dimensions = 2 [default = 4];
  }

  oneof sampler_type {
    Halton halton = 1;
    MaxMinDist maxmindist = 2;
    Random random = 3;
    Sobol sobol = 4;
    Stratified stratified = 5;
    ZeroTwoSequence zerotwosequence = 6;
  }
}

message Scale {
  double x = 1 [features.field_presence = LEGACY_REQUIRED];
  double y = 2 [features.field_presence = LEGACY_REQUIRED];
  double z = 3 [features.field_presence = LEGACY_REQUIRED];
}

message Transform {
  double m00 = 1 [features.field_presence = LEGACY_REQUIRED];
  double m01 = 2 [features.field_presence = LEGACY_REQUIRED];
  double m02 = 3 [features.field_presence = LEGACY_REQUIRED];
  double m03 = 4 [features.field_presence = LEGACY_REQUIRED];
  double m10 = 5 [features.field_presence = LEGACY_REQUIRED];
  double m11 = 6 [features.field_presence = LEGACY_REQUIRED];
  double m12 = 7 [features.field_presence = LEGACY_REQUIRED];
  double m13 = 8 [features.field_presence = LEGACY_REQUIRED];
  double m20 = 9 [features.field_presence = LEGACY_REQUIRED];
  double m21 = 10 [features.field_presence = LEGACY_REQUIRED];
  double m22 = 11 [features.field_presence = LEGACY_REQUIRED];
  double m23 = 12 [features.field_presence = LEGACY_REQUIRED];
  double m30 = 13 [features.field_presence = LEGACY_REQUIRED];
  double m31 = 14 [features.field_presence = LEGACY_REQUIRED];
  double m32 = 15 [features.field_presence = LEGACY_REQUIRED];
  double m33 = 16 [features.field_presence = LEGACY_REQUIRED];
}

message TransformBegin {
  // Empty Message
}

message TransformEnd {
  // Empty Message
}

message TransformTimes {
  double start_time = 1 [features.field_presence = LEGACY_REQUIRED];
  double end_time = 2 [features.field_presence = LEGACY_REQUIRED];
}

message Translate {
  double x = 1 [features.field_presence = LEGACY_REQUIRED];
  double y = 2 [features.field_presence = LEGACY_REQUIRED];
  double z = 3 [features.field_presence = LEGACY_REQUIRED];
}

message WorldBegin {
  // Empty Message
}

message WorldEnd {
  // Empty Message
}

message Directive {
  oneof directive_type {
    Accelerator accelerator = 1;
    ActiveTransform active_transform = 2;
    AttributeBegin attribute_begin = 3;
    AttributeEnd attribute_end = 4;
    ConcatTransform concat_transform = 5;
    CoordinateSystem coordinate_system = 6;
    CoordSysTransform coord_sys_transform = 7;
    Film film = 8;
    Identity identity = 9;
    Include include = 10;
    LookAt look_at = 11;
    ReverseOrientation reverse_orientation = 12;
    Rotate rotate = 13;
    Sampler sampler = 14;
    Scale scale = 15;
    Transform transform = 16;
    TransformBegin transform_begin = 17;
    TransformEnd transform_end = 18;
    TransformTimes transform_times = 19;
    Translate translate = 20;
    WorldBegin world_begin = 21;
    WorldEnd world_end = 22;
  }
}

message PbrtProto {
  repeated Directive directives = 1;
}
